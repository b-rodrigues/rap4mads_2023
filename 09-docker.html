<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Building Reproducible Analytical Pipelines - 8&nbsp; Self-contained RAPs with Docker</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
/* The extra [class] is a hack that increases specificity enough to
   override a similar rule in reveal.js */
ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
  font-size: inherit;
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10-github_actions.html" rel="next">
<link href="./08-products.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<link rel="shortcut icon" href="img/favicon.ico">


<link rel="stylesheet" href="epub.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Self-contained RAPs with Docker</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Building Reproducible Analytical Pipelines</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/b-rodrigues/rap4mads_2023" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Download" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-download"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./Building-Reproducible-Analytical-Pipelines.pdf">
            <i class="bi bi-bi-file-pdf pe-1"></i>
          Download PDF
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./Building-Reproducible-Analytical-Pipelines.epub">
            <i class="bi bi-bi-journal pe-1"></i>
          Download ePub
          </a>
        </li>
    </ul>
    <a href="" title="Share" id="sidebar-tool-dropdown-1" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-1">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-intro_R.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-functional-programming.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A primer on functional programming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-git.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Git</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-package-dev.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Package development</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-unit-tests.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Unit tests</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-targets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Setting up pipelines with <code>{targets}</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-products.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data products</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-docker.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Self-contained RAPs with Docker</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-github_actions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">(Very) basic CI/CD with Github Actions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-nix.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Reproducibility with Nix</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-what-else.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">What else should you learn?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-conclusion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Conclusion</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">8.1</span> Introduction</a></li>
  <li><a href="#installing-docker" id="toc-installing-docker" class="nav-link" data-scroll-target="#installing-docker"><span class="header-section-number">8.2</span> Installing Docker</a></li>
  <li><a href="#the-rocker-project" id="toc-the-rocker-project" class="nav-link" data-scroll-target="#the-rocker-project"><span class="header-section-number">8.3</span> The Rocker Project</a></li>
  <li><a href="#docker-essentials" id="toc-docker-essentials" class="nav-link" data-scroll-target="#docker-essentials"><span class="header-section-number">8.4</span> Docker essentials</a></li>
  <li><a href="#making-our-own-images-and-run-some-code" id="toc-making-our-own-images-and-run-some-code" class="nav-link" data-scroll-target="#making-our-own-images-and-run-some-code"><span class="header-section-number">8.5</span> Making our own images and run some code</a></li>
  <li><a href="#reproducibility-with-docker" id="toc-reproducibility-with-docker" class="nav-link" data-scroll-target="#reproducibility-with-docker"><span class="header-section-number">8.6</span> Reproducibility with Docker</a></li>
  <li><a href="#building-a-truly-reproducible-pipeline" id="toc-building-a-truly-reproducible-pipeline" class="nav-link" data-scroll-target="#building-a-truly-reproducible-pipeline"><span class="header-section-number">8.7</span> Building a truly reproducible pipeline</a></li>
  <li><a href="#one-last-thing" id="toc-one-last-thing" class="nav-link" data-scroll-target="#one-last-thing"><span class="header-section-number">8.8</span> One last thing</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">8.9</span> Further reading</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/b-rodrigues/rap4mads_2023/edit/main/09-docker.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Self-contained RAPs with Docker</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div style="text-align:center;">
<div class="cell">
<div class="cell-output-display">
<p><img src="img/container.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>What you’ll have learned by the end of the chapter: build self-contained, truly reproducible analytical pipelines thanks to Docker.</p>
<section id="introduction" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">8.1</span> Introduction</h2>
<p>As discussed in section 7.7, while <code>{renv}</code> is a great tool that makes reproducibility quite simple, there are still some issues. In order to tackle these issues, we are going to learn about Docker. Docker is used to package software including all its dependencies, making it easy to run/deploy anywhere. The idea is to not only deliver the source code to our data products, but also include it inside a complete package that contains not only R and the required libraries to rebuild the data product, but also many components of the underlying operating system itself, which will usually be Ubuntu… which also means that if you’re familiar with Ubuntu, you’re at an advantage.</p>
<p>For rebuilding this data product, a single command can be used which will pull the Docker image from Docker Hub, start a container, build the data product, and stop.</p>
<p>If you’ve never heard of Docker before, this chapter should give you the very basic knowledge required to get started.</p>
<p>Let’s start by watching <a href="https://www.youtube.com/watch?v=-X3AeROGmOw">this very short video</a> that introduces Docker.</p>
<p>As a reminder, let’s state again what problems <code>{renv}</code> does not allow to solve. Users will need to make sure themselves that they’re running the pipeline with the same version of R, (as recorded in the <code>renv.lock</code> file), the same operating system, hope that <code>{renv}</code> will be able to install the packages (which can unfortunately sometimes fail) and hope that the underlying infrastructure (MRAN and CRAN) are up and running. In the past, these issues were solved using virtual machines. The issue with virtual machines is that you cannot work with them programmatically. In a sense, Docker can be seen a lightweight virtual machine running a Linux distribution (usually Ubuntu) that you can interact with using the command line. This also means then that familiarity with Linux distributions (and in particular Ubuntu) will make using Docker easily. Thankfully, there is a very large community of Docker users who also use R. This community is organized as the <a href="https://rocker-project.org/">Rocker Project</a> and provides a very large collection of <code>Dockerfile</code>s to get easily started. As you saw in the video above, <code>Dockerfile</code>s are simple text files that define a Docker image, from which you can start a container.</p>
</section>
<section id="installing-docker" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="installing-docker"><span class="header-section-number">8.2</span> Installing Docker</h2>
<p>The first step is to install Docker. You’ll find the instructions for Ubuntu <a href="https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository">here</a>, for Windows <a href="https://docs.docker.com/desktop/install/windows-install/">here</a> (read the system requirements section as well!) and for macOS <a href="https://docs.docker.com/desktop/install/mac-install/">here</a> (make sure to choose the right version for the architecture of your Mac, if you have an M1 Mac use <em>Mac with Apple silicon</em>).</p>
<p>After installation, it might be a good idea to restart your computer, if the installation wizard does not invite you to do so. To check whether Docker was installed successfully, run the following command in a terminal (or on the desktop app on Windows):</p>
<pre><code>docker run --rm hello-world</code></pre>
<p>This should print the following message:</p>
<pre><code>Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</code></pre>
<p>If you see this message, congratulations, you are ready to run Docker. If you see an error message about permissions, this means that something went wrong. If you’re running Linux, make sure that your user is in the Docker group by running:</p>
<pre><code>groups $USER</code></pre>
<p>you should see your username and a list of groups that your user belongs to. If a group called <code>docker</code> is not listed, then you should add yourself to the group by following <a href="https://docs.docker.com/engine/install/linux-postinstall/">these steps</a>.</p>
</section>
<section id="the-rocker-project" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="the-rocker-project"><span class="header-section-number">8.3</span> The Rocker Project</h2>
<p>The Rocker Project is instrumental for R users that want to use Docker. The project provides a large list of images that are ready to run with a single command. As an illustration, open a terminal and paste the following line:</p>
<pre><code>docker run --rm -e PASSWORD=yourpassword -p 8787:8787 rocker/rstudio</code></pre>
<p>Once this stops running, go to <code>http://localhost:8787/</code> and enter <code>rstudio</code> as the username and <code>yourpassword</code> as the password. You should login to a RStudio instance: this is the web interface of RStudio that allows you to work with R from a server. In this case, the <em>server</em> is the Docker container running the image. Yes, you’ve just pulled a Docker image containing Ubuntu with a fully working installation of RStudio web!</p>
<p>(If you cannot connect to <code>http://localhost:8787</code>, try with the following command:</p>
<pre><code>docker run --rm -ti -d -e PASSWORD=yourpassword -p 8787:8787 --network="host" rocker/rstudio</code></pre>
<p>)</p>
<p>Let’s open a new script and run the following lines:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can now stop the container (by pressing <code>CTRL-C</code> in the terminal). Let’s now rerun the container… (with the same command as before) you should realize that your script is gone! This is the first lesson: whatever you do inside a container will disappear once the container is stopped. This also means that if you install the R packages that you need while the container is running, you will need to reinstall them every time. Thankfully, the Rocker Project provides a list of images with many packages already available. For example to run R with the <code>{tidyverse}</code> collection of packages already pre-installed, run the following command:</p>
<pre><code>docker run --rm -ti -e PASSWORD=yourpassword -p 8787:8787 rocker/tidyverse</code></pre>
<p>If you compare it to the previous command, you see that we have replaced <em>rstudio</em> with <em>tidyverse</em>. This is because <code>rocker/tidyverse</code> references an image, hosted on Docker Hub, that provides the latest version of R, RStudio server and the packages from the <code>{tidyverse}</code>. You can find the image hosted on Docker Hub <a href="https://hub.docker.com/r/rocker/tidyverse">here</a>. There are many different images, and we will be using the <em>versioned</em> images made specifically for reproducibility. For now, however, let’s stick with the <code>tidyverse</code> image, and let’s learn a bit more about some specifics.</p>
</section>
<section id="docker-essentials" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="docker-essentials"><span class="header-section-number">8.4</span> Docker essentials</h2>
<p>You already know about running containers using <code>docker run</code>. With the commands we ran before, your terminal will need to stay open, or else, the container will stop. Starting now, we will run Docker commands in the background. For this, we will use the <code>-d</code> flag (<code>d</code> as in <em>detach</em>), so let’s stop the container one last time with <code>CTRL-C</code> and rerun it using:</p>
<pre><code>docker run --rm -d -e PASSWORD=yourpassword -p 8787:8787 rocker/tidyverse</code></pre>
<p>(notice <code>-d</code> just after <code>run</code>). You can run several containers in the background simultaneously. You can list running containers with <code>docker ps</code>:</p>
<pre><code>docker ps
CONTAINER ID   IMAGE              COMMAND   CREATED         STATUS         PORTS                                       NAMES
c956fbeeebcb   rocker/tidyverse   "/init"   3 minutes ago   Up 3 minutes   0.0.0.0:8787-&gt;8787/tcp, :::8787-&gt;8787/tcp   elastic_morse</code></pre>
<p>The running container has the ID <code>c956fbeeebcb</code>. Also, the very last column, shows the name of the running container. This is a label that you can change. For now, take note of ID, because we are going to stop the container:</p>
<pre><code>docker stop c956fbeeebcb</code></pre>
<p>After Docker is done stopping the running container, you can check the running containers using <code>docker ps</code> again, but this time no containers should get listed. Let’s also discuss the other flags <code>--rm</code>, <code>-e</code> and <code>-p</code>. <code>--rm</code> removes the container once it’s stopped. Without this flag, we can restart the container and all the data and preferences we saved will be restored. However, this is dangerous because if the container gets removed, then everything will get lost, forever. We are going to learn how to deal with that later. <code>-e</code> allows you to provide environment variables to the container, so in this case the <code>$PASSWORD</code> variable. <code>-p</code> is for setting the port at which your app is going to get served. Let’s now rerun the container, but by giving it a name:</p>
<pre><code>docker run -d --name my_r --rm -e PASSWORD=yourpassword -p 8787:8787 rocker/tidyverse</code></pre>
<p>Notice the <code>--name</code> flag followed by the name we want to use, <code>my_r</code>. We can now interact with this container using its name instead of its ID. For example, let’s open an interactive bash session. Run the following command:</p>
<pre><code>docker exec -ti my_r bash</code></pre>
<p>You are now inside a terminal session, inside the running container! This can be useful for debugging purposes. It’s also possible to start R in the terminal, simply replace <code>bash</code> by <code>R</code> in the command above.</p>
<p>Finally, let’s solve the issue of our scripts disappearing. For this, create a folder somewhere on your computer (host). Then, rerun the container, but this time with this command:</p>
<pre><code>docker run -d --name my_r --rm -e PASSWORD=yourpassword -p 8787:8787 -v /path/to/your/local/folder:/home/rstudio/scripts:rw rocker/tidyverse</code></pre>
<p>where <code>/path/to/your/local/folder</code> should be replaced to the folder you created. You should now be able to save the scripts inside the <code>scripts/</code> folder from RStudio and they will appear in the folder you created.</p>
</section>
<section id="making-our-own-images-and-run-some-code" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="making-our-own-images-and-run-some-code"><span class="header-section-number">8.5</span> Making our own images and run some code</h2>
<p>We now know how to save files to our computer from Docker. But as the container gets stopped (and removed because of –rm) if we install R packages, we would need to reinstall them each time. The solution is thus to create our own Docker image, and as you will see, it is quite simple to get started. Create a folder somewhere on your computer, and add a text file called <code>Dockerfile</code> (without any extension). In this file add, the following lines:</p>
<pre><code>FROM rocker/tidyverse

RUN R -e "devtools::install_github('b-rodrigues/myPackage', ref = 'e9d9129de3047c1ecce26d09dff429ec078d4dae')"</code></pre>
<p>Every <code>Dockerfile</code> starts with a <code>FROM</code> statement. This means that this <code>Dockerfile</code> will use the <code>rocker/tidyverse</code> image as a starting point. Then, we will simply download the package we’ve been developing together using a <code>RUN</code> statement, which you’ve guessed it, runs a command. Then we need to build the image. For this, run the following line:</p>
<pre><code>docker build -t my_package .</code></pre>
<p>This will build the image right in this folder and call it <code>my_package</code>.</p>
<pre><code>Sending build context to Docker daemon  2.048kB
Step 1/2 : FROM rocker/tidyverse
 ---&gt; a838ee142831
Step 2/2 : RUN R -e "devtools::install_github('b-rodrigues/myPackage', ref = 'e9d9129de3047c1ecce26d09dff429ec078d4dae')"
 ---&gt; Using cache
 ---&gt; 17d5d3179293
Successfully built 17d5d3179293
Successfully tagged my_package:latest</code></pre>
<p>By running <code>docker images</code> you should see all the images that are on your PC (with running containers or not):</p>
<pre><code>docker images</code></pre>
<pre><code>REPOSITORY         TAG       IMAGE ID       CREATED          SIZE
my_package         latest    17d5d3179293   13 minutes ago   2.16GB
rocker/tidyverse   latest    a838ee142831   11 days ago      2.15GB
rocker/rstudio     latest    d110bab4d154   11 days ago      1.79GB
hello-world        latest    feb5d9fea6a5   13 months ago    13.3kB</code></pre>
<p>You should see that each image takes up a lot of space: but this is misleading. Each image that builds upon another does not duplicate the same layers. So this means that our image, <code>my_package</code>, only add the <code>{myPackage}</code> package to the <code>rocker/tidyverse</code> image, which in turn only adds the <code>{tidyverse}</code> packages to <code>rocker/rstudio</code>. This means unlike what is shown here, all the images to not need 6GB of space, but only 2.16GB in total. So let’s now make sure that every other container is stopped (because we will run our container on the same port) and let’s run our container using this command:</p>
<pre><code>docker run --rm -d --name my_package_container -e PASSWORD=yourpassword -p 8787:8787 my_package</code></pre>
<p>You should now see <code>{myPackage}</code> available in the list of packages in the RStudio pane. Let’s now go one step further. Let’s create one plot from within Docker, and make it available to the person running it. Let’s stop again our container:</p>
<pre><code>docker stop my_package_container</code></pre>
<p>Now, in the same folder where your <code>Dockerfile</code> resides, add the following <code>R</code> script (save this inside <code>my_graph.R</code>):</p>
<pre><code>library(ggplot2)
library(myPackage)

data("unemp")

canton_data &lt;- clean_unemp(unemp,
                           level_of_interest = "Canton",
                           col_of_interest = active_population)

my_plot &lt;- ggplot(canton_data) +
  geom_col(
    aes(
      y = active_population,
      x = year,
      fill = place_name
    )
  ) +
  theme(legend.position = "bottom",
        legend.title = element_blank())

ggsave("/home/rstudio/scripts/my_plot.pdf", my_plot)</code></pre>
<p>This script loads the data, and saves it to the scripts folder (as you see, this is a path inside of the Docker image). We will also need to update the <code>Dockerfile</code>. Edit it to look like this:</p>
<pre><code>FROM rocker/tidyverse

RUN R -e "devtools::install_github('b-rodrigues/myPackage', ref = 'e9d9129de3047c1ecce26d09dff429ec078d4dae')"

RUN mkdir /home/rstudio/graphs

COPY my_graph.R /home/rstudio/graphs/my_graph.R

CMD R -e "source('/home/rstudio/graphs/my_graph.R')"</code></pre>
<p>We added three commands at the end; one to create a folder (using <code>mkdir</code>) another to copy our script to this folder (so for this, remember that you should put the R script that creates the plot next to the <code>Dockerfile</code>) and finally an R command to source (or run) the script we’ve just copied. Save the <code>Dockerfile</code> and build it again:</p>
<pre><code>docker build -t my_package .</code></pre>
<p>Let’s now run our container with the following command (notice that we do not use <code>-p</code> nor the <code>-e</code> flags anymore, because we’re not interested in running RStudio in the browser anymore):</p>
<pre><code>docker run --rm --name my_package_container -v /path/to/your/local/folder:/home/rstudio/scripts:rw my_package</code></pre>
<p>After some seconds, you should see a PDF in the folder that you set up. This is the output of the script! You probably see now where this is going: we are going to define a <code>{targets}</code> pipeline that will be run each time the container is run. But one problem remains.</p>
</section>
<section id="reproducibility-with-docker" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="reproducibility-with-docker"><span class="header-section-number">8.6</span> Reproducibility with Docker</h2>
<p>Our <code>Dockerfile</code>, as it is now, is not suited for reproducibility. This is because each time the image gets built, the latest version of R and package will get pulled from the Internet. We need to use a <code>Dockerfile</code> that builds exactly the same image, regardless of when it gets built. Thankfully, the Rocker Project is here to help. A series of <code>Dockerfiles</code> are available that:</p>
<ul>
<li>always use the exact same version of R;</li>
<li>a frozen CRAN repository will be used to pull the packages;</li>
<li>a long term support of Ubuntu is used as a base image.</li>
</ul>
<p>You can read about it more <a href="https://github.com/rocker-org/rocker-versioned2/wiki/Versions">here</a>. As I’m writing this, the latest stable image uses R v4.2.1 on Ubuntu 20.04. The latest image, based on Ubuntu 22.04 and which uses the latest version of R (v4.2.2) still uses the default CRAN repository, not a frozen one. So for our purposes, we will be using the <code>rocker/r-ver:4.2.1</code> image, which you can find <a href="https://hub.docker.com/layers/rocker/r-ver/4.2.1/images/sha256-3636493af7028d899a6598ee4aabe70d231fb0ff60f61a70f8ea0ea24a51c3e6?context=explore">here</a>. What’s quite important, is to check that the CRAN mirror is frozen. Look for the line in the <code>Dockerfile</code> that starts with <code>ENV CRAN...</code> and you should see this:</p>
<div style="text-align:center;">
<div class="cell">
<div class="cell-output-display">
<p><img src="img/docker_1.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>As you can see in the screenshot, we see that the CRAN mirror is set to the 28 of October 2022. Let’s now edit our <code>Dockerfile</code> like so:</p>
<pre><code>FROM rocker/r-ver:4.2.1

RUN R -e "install.packages(c('devtools', 'ggplot2'))"

RUN R -e "devtools::install_github('b-rodrigues/myPackage', ref = 'e9d9129de3047c1ecce26d09dff429ec078d4dae')"

RUN mkdir /home/graphs

COPY my_graph.R /home/graphs/my_graph.R

CMD R -e "source('/home/graphs/my_graph.R')"</code></pre>
<p>As you can see, we’ve changed to first line to <code>rocker/r-ver:4.2.1</code>, added a line to install the required packages, and we’ve removed <code>rstudio</code> from the paths in the other commands. This is because <code>r-ver</code> does not launch an RStudio session in browser, so there’s no <code>rstudio</code> user. Before building the image, you should also update the script that creates the plot. This is because in the last line of our script, we save the plot to <code>"/home/rstudio/scripts/my_plot.pdf"</code>, but remember, there’s no <code>rstudio</code> user. So remove this from the <code>ggsave()</code> function. Also, add another line to the script, right at the bottom:</p>
<pre><code>writeLines(capture.output(sessionInfo()), "/home/scripts/sessionInfo.txt")</code></pre>
<p>so the script finally looks like this:</p>
<pre><code>library(ggplot2)
library(myPackage)

data("unemp")

canton_data &lt;- clean_unemp(unemp,
                           level_of_interest = "Canton",
                           col_of_interest = active_population)

my_plot &lt;- ggplot(canton_data) +
  geom_col(
    aes(
      y = active_population,
      x = year,
      fill = place_name
    )
  ) +
  theme(legend.position = "bottom",
        legend.title = element_blank())

ggsave("/home/scripts/my_plot.pdf", my_plot)

writeLines(capture.output(sessionInfo()), "/home/scripts/sessionInfo.txt")</code></pre>
<p>Now, build this image using:</p>
<pre><code>docker build -t my_package .</code></pre>
<p>and this will run R and install the packages. This should take some time, because <code>r-ver</code> images do not come with any packages preinstalled. Once this is done, we can run a container from this image using:</p>
<pre><code>docker run --rm --name my_package_container -v /path/to/your/local/folder:/home/scripts:rw my_package</code></pre>
<p>You should see two files now: the plot, and a <code>sessionInfo.txt</code> file. Open this file, and you should see the following:</p>
<pre><code>R version 4.2.1 (2022-06-23)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.5 LTS</code></pre>
<p>This confirms that the code ran indeed on R 4.2.1 under Ubuntu 20.04.5 LTS. You should also see that the <code>{ggplot2}</code> version used is <code>{ggplot2}</code> version 3.3.6, which is older than the version you could get now (as of November 2022), which is 3.4.0.</p>
<p>We now have all the ingredients and basic knowledge to build a fully reproducible pipeline.</p>
</section>
<section id="building-a-truly-reproducible-pipeline" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="building-a-truly-reproducible-pipeline"><span class="header-section-number">8.7</span> Building a truly reproducible pipeline</h2>
<p>Ok so we are almost there; we now know how to run code in an environment that is completely stable, so our results are 100% reproducible. However, there are still some things that we can learn in order to make our pipeline even better. First of all, we can make it run faster by creating an image that has already all the packages that we need installed. This way, whenever we will need to build it, no packages will need to be installed. We will also put this image on Docker Hub, so in the future, people that want to run our pipeline can do so by pulling the pre-built image from Docker, instead of having to rebuild it using the <code>Dockerfile</code>. In order to get an image on Docker Hub, you first need to create an account <a href="https://hub.docker.com/">there</a>. Once logged in, you can click on <code>Create repository</code>:</p>
<div style="text-align:center;">
<div class="cell">
<div class="cell-output-display">
<p><img src="img/docker_2.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>You can then give a name to this repository. Let’s now create an image that we will push. Let’s restart from the <code>Dockerfile</code> that we used, and add a bunch of stuff:</p>
<pre><code>FROM rocker/r-ver:4.2.1

RUN apt-get update &amp;&amp; apt-get install -y \
    libglpk-dev \
    libxml2-dev \
    libcairo2-dev \
    libgit2-dev \
    default-libmysqlclient-dev \
    libpq-dev \
    libsasl2-dev \
    libsqlite3-dev \
    libssh2-1-dev \
    libxtst6 \
    libcurl4-openssl-dev \
    libharfbuzz-dev \
    libfribidi-dev \
    libfreetype6-dev \
    libpng-dev \
    libtiff5-dev \
    libjpeg-dev \
    unixodbc-dev \
    wget

RUN wget https://github.com/quarto-dev/quarto-cli/releases/download/v1.2.269/quarto-1.2.269-linux-amd64.deb -O /home/quarto.deb
RUN apt-get install --yes /home/quarto.deb
RUN rm /home/quarto.deb

RUN R -e "install.packages(c('devtools', 'tidyverse', 'janitor', \
   'shiny', 'targets', 'tarchetypes', \
   'quarto', 'shiny', 'testthat', \
   'usethis', 'rio'))"

RUN R -e "devtools::install_github('b-rodrigues/myPackage', ref = 'e9d9129de3047c1ecce26d09dff429ec078d4dae')"

CMD ["R"]</code></pre>
<p>This <code>Dockerfile</code> starts off with <code>r-ver:4.2.1</code> and adds the dependencies that we will need for our pipelines. Then, I install development libraries, these are required to run the R packages (maybe not all of them though). I found the list <a href="https://github.com/rocker-org/rocker-versioned2/blob/master/scripts/install_tidyverse.sh">here</a>; this is a script that gets used by some of the <code>Dockerfile</code>s provided by the Rocker Project. I only copied the parts I needed. Then I download the Quarto installer for Ubuntu, and install it. Finally I install the packages for R, as well as the package we’ve developed together. This <code>Dockerfile</code> should not look too intimidating IF you’re familiar with Ubuntu. If not… well this is why I said in the intro that familiarity with Ubuntu would be helpful. Now you probably see why Rocker is so useful; if you start from an <code>rstudio</code> image all of these dependencies come already installed. But because we’re using an image made specifically for reproducibility, <em>only</em> the frozen repos were set up, which is why I had to add all of this manually. But no worries, you can now use this <code>Dockerfile</code> as a reference.</p>
<p>Anyways, we can now build this image using:</p>
<pre><code>docker build -t r421_rap .</code></pre>
<p>And now we need to wait for the process to be done. Once it’s finished, we can run it using:</p>
<pre><code>docker run --rm -ti --name r421_rap_container r421_rap </code></pre>
<p>(notice the <code>-ti</code> argument here; this is needed because we want to have an interactive session with R opened, if you omit this flag, R will get launched, but then immediately close). We can test it by loading some packages and see that everything is alright.</p>
<p>Let’s now get this image on Dockerhub; this way, we can pull it instead of having to build it in the future. First logging to Docker Hub from the terminal:</p>
<pre><code>docker login </code></pre>
<p>You should then enter your username and password. We are now ready to push, so check the image id using <code>docker images</code>:</p>
<pre><code>docker images
REPOSITORY         TAG       IMAGE ID       CREATED          SIZE
r421_rap           latest    864350bf1143   5 minutes ago    1.98GB</code></pre>
<p>Tag the image, in this case the tag I’ve used is <code>version1</code>:</p>
<pre><code>docker tag 864350bf1143 your_username_on_docker_hub/r421_rap:version1</code></pre>
<p>And now I can push it, so that everyone can use it:</p>
<pre><code>docker push brodriguesco/r421_rap:version1</code></pre>
<p>We can now use this as a base for our pipelines! Let’s now create a new <code>Dockerfile</code> that will use this image as a base and run the plot from before:</p>
<pre><code>FROM brodriguesco/r421_rap:version1

RUN mkdir /home/graphs

COPY my_graph.R /home/graphs/my_graph.R

CMD R -e "source('/home/graphs/my_graph.R')"</code></pre>
<p>save this <code>Dockerfile</code> in a new folder, and don’t forget to add the <code>my_graph.R</code> script with it. You can now build the image using:</p>
<pre><code>docker build -t my_pipeline .</code></pre>
<p>You should see this:</p>
<pre><code>Sending build context to Docker daemon  3.584kB
Step 1/4 : FROM brodriguesco/r421_rap:version1
version1: Pulling from brodriguesco/r421_rap
eaead16dc43b: Pull complete </code></pre>
<p>As you can see, now Docker is pulling the image I’ve uploaded… and what’s great is that this image already contains the correct versions of the required packages and R.</p>
<p>Before continuing now, let’s make something very clear: the image that I made available on Docker Hub is prebuilt, which means that anyone building a project on top of it, will not have to rebuild it. This means also, that in theory, there would be no need to create an image built on top of an image like <code>rocker/r-ver:4.2.1</code> with frozen repositories. Because most users of the <code>brodriguesco/r421_rap</code> image would have no need to rebuild it. However, in cases where users would need to rebuild it, it is best practice to use such a stable image as <code>rocker/r-ver:4.2.1</code>. This makes sure that if the image gets rebuilt in the future, then it still pulls the exact same R and packages versions as today.</p>
<p>Ok, so now to run the pipeline this line will do the job:</p>
<pre><code>docker run --rm --name my_pipeline_container -v /home/cbrunos/docker_folder:/home/scripts:rw my_pipeline</code></pre>
<p>So basically, all you need for your project to be reproducible is a Github repo, where you make the <code>Dockerfile</code> available, as well as the required scripts, and give some basic instructions in a <code>Readme</code>.</p>
<p>To conclude this section, take a look at <a href="https://github.com/b-rodrigues/dockerized_pipeline_demo/tree/main">this repository</a>. This repository defines in three files a pipeline that uses Docker for reproducibility:</p>
<ul>
<li>A <code>Dockerfile</code>;</li>
<li><code>_targets.R</code> defining a <code>{targets}</code> pipeline;</li>
<li><code>functions.R</code> which includes needed functions for the pipeline.</li>
</ul>
<p>Try to run the pipeline, and study the different files. You should recognize the commands used in the <code>Dockerfile</code>.</p>
<p>Now it’s your turn to build reproducible pipelines!</p>
</section>
<section id="one-last-thing" class="level2" data-number="8.8">
<h2 data-number="8.8" class="anchored" data-anchor-id="one-last-thing"><span class="header-section-number">8.8</span> One last thing</h2>
<p>It should be noted that you can also use <code>{renv}</code> in combination with Docker. What you could do is copy an <code>{renv}</code> lockfile into Docker, and restore the packages with <code>{renv}</code>. You could then push this image, which would contain every package, to Docker Hub, and then provide this image to your future users instead. This way, you wouldn’t need to use a base image with frozen CRAN repos as we did. That’s up to you.</p>
</section>
<section id="further-reading" class="level2" data-number="8.9">
<h2 data-number="8.9" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">8.9</span> Further reading</h2>
<ul>
<li>https://www.statworx.com/content-hub/blog/wie-du-ein-r-skript-in-docker-ausfuehrst/ (in German, English translation: https://www.r-bloggers.com/2019/02/running-your-r-script-in-docker/)</li>
<li>https://colinfay.me/docker-r-reproducibility/</li>
<li>https://jsta.github.io/r-docker-tutorial/</li>
<li>http://haines-lab.com/post/2022-01-23-automating-computational-reproducibility-with-r-using-renv-docker-and-github-actions/</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./08-products.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data products</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10-github_actions.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">(Very) basic CI/CD with Github Actions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>